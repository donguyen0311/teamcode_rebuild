"use strict";!function(){function e(e,t,o,n){function r(e,t,o){e.isAuthenticate()&&o(function(){t.go("structure.home")})}function l(e,t,o){e.authentication().then(function(e){e.success||o(function(){t.go("blank.login")})},function(e){o(function(){t.go("blank.login")})})}r.$inject=["userService","$state","$timeout"],l.$inject=["userService","$state","$timeout"],n.interceptors.push("authInterceptor"),e.state("blank",{abstract:!0,views:{root:{templateUrl:"app/templates/blank.html"}},resolve:{isAuthenticated:r}}).state("structure",{abstract:!0,views:{root:{templateUrl:"app/templates/structure.html"}}}).state("structure.home",{url:"/",views:{header:{templateUrl:"app/templates/header.html",controller:"headerController",controllerAs:"vm"},content:{templateUrl:"app/templates/home.html",controller:"mainController",controllerAs:"vm"}}}).state("blank.login",{url:"/login",views:{"":{templateUrl:"app/templates/login.html",controller:"loginController",controllerAs:"vm"}}}).state("blank.register",{url:"/register",views:{"":{templateUrl:"app/templates/register.html",controller:"registerController",controllerAs:"vm"}}}).state("structure.profile",{url:"/profile",views:{header:{templateUrl:"app/templates/header.html",controller:"headerController",controllerAs:"vm"},sidebar:{templateUrl:"app/templates/sidebar.html",controller:"sidebarController",controllerAs:"vm"},content:{templateUrl:"app/templates/profile.html",controller:"profileController",controllerAs:"vm"}},resolve:{redirectIfNotAuthenticated:l}}).state("structure.dashboard",{url:"/dashboard",views:{header:{templateUrl:"app/templates/header.html",controller:"headerController",controllerAs:"vm"},sidebar:{templateUrl:"app/templates/sidebar.html",controller:"sidebarController",controllerAs:"vm"},content:{templateUrl:"app/templates/dashboard.html",controller:"dashboardController",controllerAs:"vm"}},resolve:{redirectIfNotAuthenticated:l}}).state("structure.editor",{url:"/editor",views:{header:{templateUrl:"app/templates/header.html",controller:"headerController",controllerAs:"vm"},sidebar:{templateUrl:"app/templates/sidebar.html",controller:"sidebarController",controllerAs:"vm"},content:{templateUrl:"app/templates/editor.html",controller:"editorController",controllerAs:"vm"}}}),o.otherwise("/")}e.$inject=["$stateProvider","$locationProvider","$urlRouterProvider","$httpProvider"],angular.module("myApp",["ngAnimate","ngSanitize","ngCookies","dndLists","ngAria","ngMaterial","ngMessages","ui.router","ui.layout","ui.codemirror","app.controllers","app.directives","app.services","jsTree.directive","ngFileSaver"]).config(e).run(["$rootScope","$state","$stateParams","socket",function(e,t,o,n){e.$state=t,e.$stateParams=o,n.on("connection",function(){console.log("connected to server")})}])}(),angular.module("app.controllers",["app.controllers.maincontroller","app.controllers.headercontroller","app.controllers.sidebarcontroller","app.controllers.logincontroller","app.controllers.registercontroller","app.controllers.profilecontroller","app.controllers.dashboardcontroller","app.controllers.editorcontroller"]),function(){function e(e,t){e.models={selected:null,lists:{A:[],B:[],C:[],D:[]}};for(var o=1;o<=3;++o)e.models.lists.A.push({label:"Item A"+o,name:"Name A"+o}),e.models.lists.B.push({label:"Item B"+o,name:"Name B"+o}),e.models.lists.C.push({label:"Item C"+o,name:"Name C"+o}),e.models.lists.D.push({label:"Item D"+o,name:"Name D"+o});t(function(){e.models.lists.A.push({label:"Item A10",name:"Name A10"})},2e3),e.insertedEvent=function(e,t,o,n){console.log(e,t,o,n)},e.$watch("models",function(t){e.modelAsJson=angular.toJson(t,!0),console.log(t)},!0)}e.$inject=["$scope","$timeout"],angular.module("app.controllers.dashboardcontroller",[]).controller("dashboardController",e)}(),function(){function e(e){e.coreConfig={check_callback:function(e,t,o,n,r){return(!r||!r.dnd||"i"===r.pos)&&("move_node"!==e&&"copy_node"!==e||this.get_node(t).parent!==this.get_node(o).id)},themes:{responsive:!0}},e.typesConfig={default:{icon:"folder"},file:{valid_children:[],icon:"file"},folder:{icon:"folder"}},e.contextMenuAction=function(e){console.log(e);var t=$.jstree.defaults.contextmenu.items();return delete t.create.action,t.create.label="New",t.create.submenu={Folder:{separator_after:!0,label:"Folder",action:function(e){var t=$.jstree.reference(e.reference),o=t.get_node(e.reference);t.create_node(o,{type:"folder",icon:"jstree-folder"},"last",function(e,o,n){console.log(e,o,n),setTimeout(function(){t.edit(e)},0)})}},File:{label:"File",action:function(e){var t=$.jstree.reference(e.reference),o=t.get_node(e.reference);t.create_node(o,{type:"file",icon:"jstree-file",li_attr:{isLeaf:!0}},"last",function(e){setTimeout(function(){t.edit(e)},0)})}}},t.refresh={},t.refresh.label="Refresh",t.refresh.action=function(e){var t=$.jstree.reference(e.reference),o=t.get_node(e.reference);t.refresh_node(o)},t.downloadFolder={},t.downloadFolder.label="Download",t.downloadFolder.action=function(e){var t=$.jstree.reference(e.reference).get_node(e.reference),o=t.id,n=t.text;console.log(t),$http({url:"api/action?operation=download_node",method:"POST",data:{url:o,name:n},responseType:"arraybuffer"}).then(function(e){console.log(e,e.headers()["content-type"]);var t=new Blob([e.data],{type:e.headers()["content-type"]});FileSaver.saveAs(t,e.config.data.name+".zip")},function(e){console.log(e)})},t.downloadFile={},t.downloadFile.label="Download",t.downloadFile.action=function(e){var t=$.jstree.reference(e.reference).get_node(e.reference),o=t.id,n=t.text;console.log(t),$http({url:"api/action?operation=download_node",method:"POST",data:{url:o,name:n}}).then(function(e){console.log(e,e.headers()["content-type"]);var t=new Blob([e.data],{type:e.headers()["content-type"]});FileSaver.saveAs(t,e.config.data.name)},function(e){console.log(e)})},t.uploadFolder={},t.uploadFolder.label="Upload",t.uploadFolder.action=function(e){var t=$.jstree.reference(e.reference),o=t.get_node(e.reference),n=o.id,r=document.createElement("input");r.style.display="none",r.type="file",r.name="file",r.id="uploadFile",r.addEventListener("change",function(){var e=r.files[0],l=new FormData;l.append("file",e),$http({url:"api/action?operation=upload_node&url="+n,method:"PUT",data:l,transformRequest:angular.identity,headers:{"Content-Type":void 0}}).then(function(e){console.log(e),200==e.data.code&&t.refresh_node(o)},function(e){console.log(e)})}),r.click()},"file"===$.jstree.reference(e).get_type(e)&&(delete t.create,delete t.downloadFolder,delete t.uploadFolder),"folder"===$.jstree.reference(e).get_type(e)&&delete t.downloadFile,t},e.nodeRename=function(e,t){console.log("rename",e,t),t.old!==t.text&&$http({url:"api/action?operation=rename_node",method:"POST",data:{id:t.node.id,text:t.text,parent:t.node.parent}}).then(function(e){updateRenameTabs(t.node.id,e.data.id,t.text),t.instance.set_id(t.node,e.data.id),t.node.li_attr.base=e.data.id,t.instance.refresh_node(t.node)},function(e){console.log(e),t.instance.refresh_node(t.node)})},e.nodeCopy=function(e,t){console.log("copy",e,t),$http({url:"api/action?operation=copy_node",method:"POST",data:{id:t.original.id,parent:t.parent,text:t.original.text}}).then(function(e){t.instance.load_node(t.parent)},function(e){t.instance.refresh()})},e.nodeMove=function(e,t){console.log("move",e,t),$http({url:"api/action?operation=move_node",method:"POST",data:{id:t.node.id,parent:t.parent,text:t.node.text}}).then(function(e){updateMoveTabs(t.node.id,e.data.id),t.instance.load_node(t.parent)},function(e){t.instance.refresh()})},e.nodeDelete=function(e,t){console.log("delete",e,t),$http({url:"api/action?operation=delete_node",method:"POST",data:{id:t.node.id}}).then(function(e){updateDeleteTabs(t.node.id)},function(e){t.instance.refresh_node(t.node)})},e.nodeCreate=function(e,t){console.log("create",e,t),$http({url:"api/action?operation=create_node",method:"POST",data:{type:t.node.type,parent:t.node.parent,text:t.node.text}}).then(function(e){t.instance.set_id(t.node,e.data.id)},function(e){t.instance.refresh_node(t.node)})},e.nodeSelected=function(e,t){},e.editorOptions={lineNumbers:!0,lineWrapping:!0,extraKeys:{"Ctrl-Space":"autocomplete","Ctrl-F":"findPersistent","Ctrl-J":"toMatchingTag","Ctrl-Q":"toggleComment"},mode:"application/x-httpd-php",selectionPointer:!0,autoCloseTags:!0,autoCloseBrackets:!0,styleActiveLine:!0,tabSize:2,gutters:["CodeMirror-lint-markers","CodeMirror-linenumbers","breakpoints"],lint:!0,scrollbarStyle:"simple",profile:"xhtml",matchTags:{bothTags:!0},matchBrackets:!0},e.codemirrorLoaded=function(e){e.focus(),change("demo.js",e)}(value)}e.$inject=["$scope"],angular.module("app.controllers.editorcontroller",[]).controller("editorController",e)}(),function(){function e(e,t,o,n,r,l,a){function i(e){return function(){l(e).toggle()}}var s=this;s.toggleLeft=i("left"),s.toggleRight=i("right"),s.isNavCollapsed=!0,s.isAuthenticate=t.isAuthenticate,s.email=o.sessionStorage.email,s.logout=function(){t.logout().then(function(e){e.success&&n.go("blank.login")})},s.openMenu=function(e,t){e.open(t)}}e.$inject=["$scope","userService","$window","$state","$timeout","$mdSidenav","$mdDialog"],angular.module("app.controllers.headercontroller",[]).controller("headerController",e)}(),function(){function e(e,t,o,n,r){function l(){t.login(a.user).then(function(e){e.success?(r.showToast(e.message,"top right",2e3),n(function(){o.go("structure.profile")},2e3)):r.showToast(e.message,"top right",5e3)},function(e){e&&o.go("blank.login")})}var a=this;a.alerts=[],a.login=l}e.$inject=["$scope","userService","$state","$timeout","toastService"],angular.module("app.controllers.logincontroller",[]).controller("loginController",e)}(),function(){function e(e,t){$("#particles").particleground({dotColor:"#796b6b",lineColor:"#796b6b"}),$("#intro").css({"margin-top":-$("#intro").height()/2})}e.$inject=["$scope","$cookies"],angular.module("app.controllers.maincontroller",[]).controller("mainController",e)}(),function(){function e(e,t,o,n){function r(){var e=document.createElement("input");return e.style.display="none",e.type="file",e.name="file",e.accept="image/*",e.onchange=function(o){console.log(e.files,o);var n=e.files[0],r=new FormData;r.append("file",n),t.uploadImage(r).then(function(e){console.log(e)},function(e){console.log(e)})},e}var l=this;l.countContribute=0,l.countProject=0,t.getUserInfo(o.sessionStorage.email).then(function(e){l.user=e.user},function(e){console.log(e)}),l.changeImage=function(){console.log("click"),r().click()}}e.$inject=["$scope","userService","$window","$timeout"],angular.module("app.controllers.profilecontroller",[]).controller("profileController",e)}(),function(){function e(e,t,o,n,r){function l(){n.register(a.user).then(function(e){e.success?(r.showToast(e.message,"top right",2e3),o(function(){t.go("blank.login")},2e3)):r.showToast(e.message,"top right",5e3)},function(e){e&&t.go("blank.register")})}var a=this;a.alerts=[],a.register=l}e.$inject=["$scope","$state","$timeout","userService","toastService"],angular.module("app.controllers.registercontroller",[]).controller("registerController",e)}(),function(){function e(e,t,o){this.logout=function(){t.logout().then(function(e){e.success&&o.go("blank.login")})}}e.$inject=["$scope","userService","$state"],angular.module("app.controllers.sidebarcontroller",[]).controller("sidebarController",e)}(),function(){function e(e,t,o,n){return{request:function(e){return e.headers=e.headers||{},t.sessionStorage.token&&(e.headers["x-access-token"]=t.sessionStorage.token),e},response:function(e){return e},responseError:function(e){return 403===e.status&&o.go("blank.login"),e}}}e.$inject=["$q","$window","$state","$location"],angular.module("app.services.autheninterceptorservice",[]).factory("authInterceptor",e)}(),angular.module("app.services",["app.services.userservice","app.services.autheninterceptorservice","app.services.toastservice","app.services.socketservice"]),function(){function e(e){var t=io.connect();return{on:function(o,n){t.on(o,function(){var o=arguments;e.$apply(function(){n.apply(t,o)})})},emit:function(o,n,r){t.emit(o,n,function(){var o=arguments;e.$apply(function(){r&&r.apply(t,o)})})}}}e.$inject=["$rootScope"],angular.module("app.services.socketservice",[]).factory("socket",e)}(),function(){function e(e,t){return{showToast:function(t,o,n){var r=o,l=e.simple().textContent(t).action("CLOSE").highlightAction(!0).hideDelay(n).highlightClass("md-accent").position(r);e.show(l).then(function(t){"ok"==t&&e.hide()})}}}e.$inject=["$mdToast","$mdDialog"],angular.module("app.services.toastservice",[]).factory("toastService",e)}(),function(){function e(e,t,o,n){return{login:function(o){var r=t.defer();return e.post("/api/login",o).then(function(e){console.log(e),e.data.success&&(n.sessionStorage.token=e.data.token,n.sessionStorage.email=o.email),r.resolve(e.data)},function(e){r.reject(e)}),r.promise},register:function(o){var n=t.defer();return e.post("/api/register",o).then(function(e){console.log(e),n.resolve(e.data)},function(e){n.reject(e)}),n.promise},authentication:function(){var o=t.defer();return e.get("/api/authenticate").then(function(e){o.resolve(e.data)},function(e){o.reject(e)}),o.promise},logout:function(){var e=t.defer();return delete n.sessionStorage.token,delete n.sessionStorage.email,e.resolve({success:!0}),e.promise},getUserInfo:function(o){var n=t.defer();return e.get("/api/users/"+o).then(function(e){n.resolve(e.data)},function(e){n.reject(e)}),n.promise},isAuthenticate:function(){return!(!n.sessionStorage.token||!n.sessionStorage.email)},uploadImage:function(o){var n=t.defer();return e.put("/api/users/image",o,{transformRequest:angular.identity,headers:{"Content-Type":void 0}}).then(function(e){n.resolve(e.data)},function(e){n.reject(e)}),n.promise}}}e.$inject=["$http","$q","$cookies","$window"],angular.module("app.services.userservice",[]).factory("userService",e)}(),angular.module("app.directives",[]);